

--CREATE DATABASE VISITORDB;
--USE  VISITORDB
 CREATE TABLE VISITOR(
 VID  BIGINT PRIMARY KEY ,
 VNAME NVARCHAR(20)  NOT NULL,
 LID   BIGINT NOT NULL ,FOREIGN KEY REFERENCES LOCAATION(LId),
 PCOMPANY NVARCHAR(29) NOT NULL,
 PURPOSE  NVARCHAR(22) NOT NULL,
 VDATE  NVARCHAR NOT NULL,
 HID BIGINT NOT NULL FOREIGN KEY REFERENCES HOST(HId)
 )

  
  CREATE TABLE HOST(
 HID  BIGINT PRIMARY KEY ,
 HNAME NVARCHAR(20)  NOT NULL,
 EMPNO NVARCHAR(20) NOT NULL,
 DEPT NVARCHAR(20) NOT NULL,
 LID BIGINT NOT NULL FOREIGN KEY REFERENCES LOCAATION(LId),
 )
  
  CREATE TABLE LOCAATION(
  LID BIGINT PRIMARY KEY ,
  LOCNAME NVARCHAR(20)  NOT NULL
  )
  CREATE TABLE MOBILENUMBER(
  MID BIGINT PRIMARY KEY ,
  MNO NVARCHAR(20)  NOT NULL,
  VID BIGINT NOT NULL FOREIGN KEY REFERENCES VISITOR(VID)
  )
 
  --*******************************************
  --1.
  INSERT INTO HOST VALUES (101, 'SUBBARAYUDU', 263441, 'IT', 1),
 (102, 'RAYUDU', 200303, 'IT', 2),
 (103, 'VAMSI', 363304, 'IT', 2),
 (104, 'KRISHNA', 463305, 'BANKING', 3),
 (105, 'GUNA', 263906, 'MANAGER', 2),
 (106, 'PRASAD', 832307, 'MECH', 1)
  
 INSERT INTO VISITOR VALUES
 (201, 'SAGAR',1,'MPHASIS','PERSONNEL','2/04/2025',1001),
 (202, 'HARI',2,'DLF','BUSINESS','6/05/2025',1004),
 (203, 'REDDAIAH',2,'MPHASIS','PERSONNEL','19/05/2024',1007),
 (204, 'AYUB',1,'GOOGLE','BUSINESS','22/05/2025',1003),
 (205, 'SUDHERE',3,'FINWORKS','PERSONNEL','12/03/2024',1003),
 (206, 'CHANDRA',3,'TATA COM','BUSINESS','2/02/2025',1005),
 (207, 'MAHESH',1,'MICROSOFT','PERSONNEL','12/1/2025',1006),
 (208, 'NAGARAJU',1,'TCS','PERSONNEL','2/03/2024',1002)
  
 INSERT INTO MOBILENUMBER VALUES
 (102,9110502842,2002),
 (103,7563334123,2003),
 (104,9336790093,2004),
 (105,9878946123,2005),
 (106,9856032473,2006),
 (107,9856000912,2007),
 (108,9446700124,2008)
 
 
 INSERT INTO LOCAATION
 VAlUES
 (1,'PUNE'),
 (2,'BANGALORE'),
 (3,'CHENNAI')
 
 --2.
 SELECT * FROM LOCAATION
  
 --3.
 SELECT VI.VNAME,LOCNAME FROM VISITOR VI
 INNER JOIN LOCAATION L ON L.LId = VI.LID
  
 --4.
 SELECT * FROM LOCAATION
 WHERE LOCNAME LIKE 'H%'
  
 --5.
 SELECT COUNT(*)HOSTCOUNT FROM HOST
  
 --6.
 SELECT COUNT(*)HOSTCOUNT FROM HOST
 WHERE LID = 1
  
 --7.
 SELECT * FROM VISITOR
 WHERE HID = 1003
  
 --8.
 SELECT * FROM VISITOR
 WHERE VDATE='2/05/2026'
  
 --9.
 SELECT * FROM VISITOR
 ORDER BY VDATE
  
 --10.
 SELECT * FROM VISITOR
 WHERE HID IS NULL
  
 --11.
 SELECT VISITOR.*,HNAME FROM VISITOR
 INNER JOIN HOST H ON H.HID = VISITOR.HID
 WHERE H.HNAME = 'SUBBARAYUDU'
  
 --12.
 SELECT V.*,H.HName FROM VISITOR V
 INNER JOIN Host H ON H.HID = V.HID
 WHERE H.DEPT = 'IT'
  
 --13.
 SELECT COUNT(*) VISITORCOUNT FROM VISITOR WHERE HID=1007 AND VDATE='2/04/2025'
  
 --14.
 SELECT COUNT(*)VISITORCOUNT FROM VISITOR
 WHERE LID = 1 OR VDATE='22/05/2025'
  
 --15.
 SELECT * FROM VISITOR
 WHERE HID = (SELECT TOP 1 HID FROM VISITOR 
 GROUP BY HId
 ORDER BY COUNT(*) DESC)
  
 --16.
 SELECT H.* FROM HOST H JOIN (SELECT HID,COUNT(*) VISITORCOUNT FROM VISITOR GROUP BY HId) HV ON H.HID=HV.HId
 WHERE HV.VISITORCOUNT = (SELECT MIN(VISITORCOUNT) FROM (SELECT HID,COUNT(*) VISITORCOUNT FROM VISITOR GROUP BY HID) A) ORDER BY H.HID
  
 --17.
 SELECT *
 FROM Host
 WHERE HID NOT IN (SELECT DISTINCT HID FROM VISITOR WHERE HID IS NOT NULL);
  
 --18.
 SELECT VDATE, COUNT(*) AS VISITOR
 FROM VISITOR 
 GROUP BY VDATE
 ORDER BY VDATE;
  
 --19.
 SELECT *
 FROM VISITOR
 WHERE HId = 1 AND VDATE BETWEEN '19/05/2024' AND '22/05/2025';  
  
 --20.
 SELECT *
 FROM Host
 WHERE DEPT != 'MANAGER';
  
 --21
 SELECT *
 FROM VISITOR
 INNER JOIN MOBILENUMBER M ON M.VID = VISITOR.VID
 WHERE M.MNO IS NULL