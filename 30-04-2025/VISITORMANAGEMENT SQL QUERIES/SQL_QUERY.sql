--Create Database VisitorDB1
use VisitorDB1

CREATE TABLE VISITOR(
VID  BIGINT PRIMARY KEY ,
VNAME NVARCHAR(20)  NOT NULL,
LId   BIGINT NOT NULL FOREIGN KEY REFERENCES LOCATION(LId),
PCOMPANY NVARCHAR(29) NOT NULL,
PURPOSE  NVARCHAR(22) NOT NULL,
VDATE  NVARCHAR(20) NOT NULL,
HId BIGINT NOT NULL FOREIGN KEY REFERENCES HOST(HId)
)
 
 CREATE TABLE HOST(
HID  BIGINT PRIMARY KEY ,
HNAME NVARCHAR(20)  NOT NULL,
EMPNO NVARCHAR(20) NOT NULL,
DEPT NVARCHAR(20) NOT NULL,
LId BIGINT NOT NULL FOREIGN KEY REFERENCES LOCATION(LId),
)
 
 CREATE TABLE LOCATION(
 LId BIGINT PRIMARY KEY ,
 LOCNAME NVARCHAR(20)  NOT NULL
 )
 CREATE TABLE MOBILENUMBER(
 MId BIGINT PRIMARY KEY ,
 MNO NVARCHAR(20)  NOT NULL,
 VID BIGINT NOT NULL FOREIGN KEY REFERENCES VISITOR(VID)
 )
INSERT INTO Host VALUES (1001, 'SONA', 263301, 'IT', 1),
(1003, 'MANU', 263303, 'BIO-TECH', 2),
(1004, 'TRINAY', 263304, 'SDE', 3),
(1005, 'PREM', 263305, 'FSD', 3),
(1006, 'WASEEM', 263306, 'BANKING', 2),
(1007, 'SRUJITH', 263307, 'MECH', 1)
 
INSERT INTO VISITOR VALUES
(2001, 'PRANAV',1,'FAIRWORK','BUSINESS','2/05/2025',1001),
(2002, 'SAGAR',2,'DLF','BUSINESS','6/05/2025',1003),
(2003, 'SHAKTHI',2,'MPHASIS','PERSONNEL','10/05/2025',1006),
(2004, 'SIBBI',1,'GOOGLE','BUSINESS','25/05/2025',1003),
(2005, 'LOGESH',3,'FINWORKS','PERSONNEL','12/05/2025',1004),
(2006, 'SAQIB',3,'TATA COM','BUSINESS','2/06/2025',1005),
(2007, 'MUSTAFA',1,'MICROSOFT','PERSONNEL','12/10/2025',1002),
(2008, 'NAGARAJU',1,'FAIRWORK','BUSINESS','2/05/2026',1007)
 
INSERT INTO MOBILENUMBER VALUES
(102,9878945623,2002),
(103,7566794123,2003),
(104,9856797893,2004),
(105,9878946123,2005),
(106,9856032473,2006),
(107,9856347912,2007),
(108,9856700124,2008)


INSERT INTO LOCATION
VAlUES
(1,'HYD'),
(2,'BLR'),
(3,'TUT')

--2.
SELECT * FROM LOCATION
 
--3.
SELECT VI.VNAME,LocName FROM VISITOR VI
INNER JOIN LOCATION L ON L.LId = VI.LID
 
--4.
SELECT * FROM LOCATION
WHERE LocName LIKE 'H%'
 
--5.
SELECT COUNT(*)HOSTCOUNT FROM Host
 
--6.
SELECT COUNT(*)HOSTCOUNT FROM Host 
WHERE LID = 1
 
--7.
SELECT * FROM VISITOR
WHERE HId = 1003
 
--8.
SELECT * FROM VISITOR
WHERE VDate='2/05/2026'
 
--9.
SELECT * FROM VISITOR
ORDER BY VDATE
 
--10.
SELECT * FROM VISITOR
WHERE HId IS NULL
 
--11.
SELECT VISITOR.*,HName FROM VISITOR
INNER JOIN Host H ON H.HID = VISITOR.HId
WHERE H.HName = 'SONA'
 
--12.
SELECT V.*,H.HName FROM VISITOR V
INNER JOIN Host H ON H.HID = V.HId
WHERE H.DEPT = 'BANKING'
 
--13.
SELECT COUNT(*) VISITORCOUNT FROM VISITOR WHERE HID=1007 AND VDATE='2/05/2026'
 
--14.
SELECT COUNT(*)VISITORCOUNT FROM VISITOR
WHERE LID = 1 OR VDATE='25/05/2025'
 
--15.
SELECT * FROM VISITOR
WHERE HId = (SELECT TOP 1 HId FROM VISITOR 
GROUP BY HId
ORDER BY COUNT(*) DESC)
 
--16.
SELECT H.* FROM HOST H JOIN (SELECT HID,COUNT(*) VISITORCOUNT FROM VISITOR GROUP BY HId) HV ON H.HID=HV.HId
WHERE HV.VISITORCOUNT = (SELECT MIN(VISITORCOUNT) FROM (SELECT HID,COUNT(*) VISITORCOUNT FROM VISITOR GROUP BY HID) A) ORDER BY H.HID
 
--17.
SELECT *
FROM Host
WHERE HID NOT IN (SELECT DISTINCT HId FROM VISITOR WHERE HId IS NOT NULL);
 
--18.
SELECT VDATE, COUNT(*) AS VISITOR
FROM visitor
GROUP BY VDATE
ORDER BY VDATE;
 
--19.
SELECT *
FROM VISITOR
WHERE HId = 1 AND VDATE BETWEEN '2/05/2025' AND '25/05/2025';  
 
--20.
SELECT *
FROM Host
WHERE DEPT != 'Manager';
 
--21
SELECT *
FROM VISITOR
INNER JOIN MOBILENUMBER M ON M.VID = VISITOR.VID
WHERE M.MNO IS NULL